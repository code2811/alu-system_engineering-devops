#!/usr/bin/env bash
# Script to configure Nginx to run as nginx user on port 8080

# Stop any existing nginx processes
pkill -f nginx

# Modify nginx configuration
sed -i 's/user\s*root;/user nginx;/' /etc/nginx/nginx.conf
sed -i 's/listen\s*80;/listen 8080;/' /etc/nginx/sites-available/default
sed -i 's/listen\s*\[\:\:\]\:80;/listen [::]:8080;/' /etc/nginx/sites-available/default

# Change ownership of nginx files to nginx user
chown -R nginx:nginx /var/www/html
chown -R nginx:nginx /etc/nginx
chown -R nginx:nginx /var/log/nginx

# Start nginx as nginx user with specific configuration
sudo -u nginx nginx -g "daemon off;"
