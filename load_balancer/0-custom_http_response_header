#!/usr/bin/env bash
# This script configures a new Ubuntu machine to add a custom Nginx response header

# Update and install Nginx
sudo apt-get update
sudo apt-get install -y nginx

# Configure Nginx to add the custom header
SERVER_NAME=$(hostname)
CONFIG_FILE="/etc/nginx/nginx.conf"

# Backup the original configuration file
sudo cp $CONFIG_FILE $CONFIG_FILE.bak

# Add the custom header to the Nginx configuration
sudo sed -i "/http {/a \    add_header X-Served-By $SERVER_NAME;" $CONFIG_FILE

# Test the Nginx configuration
sudo nginx -t

# If the configuration test is successful, restart Nginx
if [ $? -eq 0 ]; then
    sudo systemctl restart nginx
    echo "Nginx has been configured successfully with the custom header X-Served-By: $SERVER_NAME"
else
    echo "Nginx configuration test failed. Please check the configuration file."
fi
