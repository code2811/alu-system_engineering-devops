#!/usr/bin/env bash
# Script to configure Nginx with custom HTTP header X-Served-By
# The value of X-Served-By is the hostname of the server

# Update packages and install nginx if not already installed
apt-get -y update
apt-get -y install nginx

# Allow Nginx HTTP traffic
ufw allow 'Nginx HTTP'

# Create necessary directories and files
mkdir -p /var/www/html
echo "Hello World!" > /var/www/html/index.html
echo "Ceci n'est pas une page" > /var/www/html/404.html

# Get the hostname of the server
HOSTNAME=$(hostname)

# Create a new Nginx configuration file with custom header
cat > /etc/nginx/conf.d/custom_header.conf << EOF
server_tokens off;
add_header X-Served-By $HOSTNAME;
EOF

# Ensure Nginx configuration is valid
nginx -t

# Restart Nginx to apply changes
service nginx restart

exit 0
