#!/bin/bash

# Install Nginx if not already installed
if ! command -v nginx &> /dev/null; then
    sudo apt-get update
    sudo apt-get install -y nginx
fi

# Ensure Nginx is running
if ! sudo systemctl is-active --quiet nginx; then
    sudo systemctl start nginx
fi

# Check if Nginx is listening on port 80
if ! sudo netstat -tuln | grep -q ':80 '; then
    # Stop any conflicting service on port 80
    sudo lsof -i :80 | awk 'NR!=1 {print $2}' | xargs -r sudo kill -9

    # Restart Nginx to ensure it listens on port 80
    sudo systemctl restart nginx
fi

# Verify Nginx is listening on port 80
if sudo netstat -tuln | grep -q ':80 '; then
    echo "Nginx is now listening on port 80."
else
    echo "Failed to configure Nginx to listen on port 80."
fi
